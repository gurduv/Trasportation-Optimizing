<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/shifts_styles.css">

    <title>Keshet Employee Management System</title>
        <script>
            const process = { env: {} };
            process.env.GOOGLE_MAPS_API_KEY =
                "AIzaSyAHYcspx40UvnTRuW0YvgVMjBsHrQ9h-aM";
        </script>
        
        <!-- <link rel="stylesheet" type="text/css" href="/css/currentlocside.css" /> -->
        <!-- <script type="module" src="/js/currentloc.js"></script> -->

    <script type="text/javascript" src="./js/csv2json.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


</head>

<body lang="he" dir="rtl">
    <div class="bg"></div>
    <div class="content">
        <header>
            <div class="headerlinks text-right header_footer_bg">
                <a href="./index.html"><img src="./img/logokeshet.png" class="logo"></a>
                <a href="./index.html">
                    <h2>קשת | האגודה למען הקשיש</h2>
                </a>
            </div>
        </header>

        <nav class="navbar navbar-expand-sm navbar-light navstyle">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav text-right">
                    <a class="nav-link" href="index.html">בית </a>
                    <a class="nav-link" href="shifts.html">משמרות</a>
                    <a class="nav-link" href="tasks.html">משימות</a>
                    <a class="nav-link" href="employees.html">עובדים</a>
                    <a class="nav-link" href="guides.html">הדרכות</a>
                    <a class="nav-link active" href="convertcsv.html">הסעות <span class="sr-only">(current)</span></a>
                </div>
            </div>
        </nav>

        <main class="text-right">
            <h1 class="font-weight-bold text-center head1">
                הסעות</h1>

            <div class="d-flex flex-md-row flex-column">
                <section class="col text-justify">

                    <article>
                        <div id="formStyle">
                            <h3 class="text-center">שליחת נתוני משמרות למערכת ההסעות</h3>

                            <form method="POST">

                                <div class="form-group">
                                    <label class="form-label" for="customFile">העלאת קובץ CSV:</label>
                                    <input type="file" id="inputfile" class="form-control col-md-8" onchange="return fileValidation()" />
                                    <br>
                                    <input type="button" value="Convert" class="btn btn-primary" onClick="applyconvert()">
                                </div>  

                                <div class="form-group">
                                    <input type="submit" value="שליחת קובץ לשרת ההסעות" class="btn btn-primary" name="submit" onclick="sendtoFirebase()">
                                </div>

                                <div class="form-group">
                                        <button id="reload" type="button" class="btn btn-danger">איפוס בחירה</button>
                                        <script>
                                            $("#reload").click(function () {
                                                location.reload(true);
                                                window.scrollTo({ top: 0, behavior: 'smooth' });
                                            });
                                        </script>
                                </div>
                                
                                <!-- <textarea id="execution" rows="18" spellcheck="false" disabled=""></textarea> -->
                                <h2>תוצאת ההמרה</h2>
                                <pre id="execution"></pre>
                                
                            </form>
                        </div>

                        <script>
                            function fileValidation() {
                                var fileInput =
                                    document.getElementById('inputfile');

                                var filePath = fileInput.value;

                                // Allowing file type
                                var allowedExtensions =
                                    /(\.csv)$/i;

                                if (!allowedExtensions.exec(filePath)) {
                                    alert('נא להעלות קבצי CSV בלבד');
                                    fileInput.value = '';
                                    return false;
                                }
                            }
                            function applyconvert() {
                                var csvcontent = ""
                                var file = document.getElementById("inputfile").files[0];
                                if (file) {
                                    var reader = new FileReader();
                                    reader.readAsText(file, "UTF-8");
                                    reader.onload = function (evt) {
                                        csvcontent = evt.target.result;
                                        // alert(csvcontent);
                                        const json = CSVJSON.csv2json(csvcontent, { parseNumbers: true });
                                        // alert(json);
                                        const execution = document.getElementById('execution');
                                        // const result = document.getElementById('result');
                                        execution.innerText = JSON.stringify(json, null, 2);
                                        const jsonContent = JSON.stringify(json, null, 2);
                                        console.log(jsonContent);

                                        var myHeaders = new Headers();
                                        myHeaders.append("Content-Type", "application/json");

                                        // var raw = JSON.stringify(
                                        //     {
                                        //         "employees": [
                                        //             {
                                        //                 "name": "Jenette Caldwell",
                                        //                 "salary": "2000",
                                        //                 "age": "15"
                                        //             },
                                        //             {
                                        //                 "name": "Jpppffenette Caldwell",
                                        //                 "salary": "3000",
                                        //                 "age": "25"
                                        //             }
                                        //         ]
                                        //     }
                                        // );

                                        var requestOptions = {
                                            method: 'PUT',
                                            headers: myHeaders,
                                            body: jsonContent,
                                            redirect: 'follow'
                                        };

                                        fetch("https://transportation-optimizing-default-rtdb.europe-west1.firebasedatabase.app/employees.json", requestOptions)
                                            .then(response => response.text())
                                            .then(result => console.log(result))
                                            .catch(error => console.log('error', error));


                                    }
                                    reader.onerror = function (evt) {
                                        csvcontent = "error reading file";
                                        // alert(csvcontent);
                                    }
                                }

                            
                            }



                        </script>
                    </article>

                </section>
                <aside>
                    <h5>הוראות:</h5>

                    <article id="eventsArticle">
                        1. הורידו קובץ תבנית משמרות אם יש צורך </article>

                    <article id="eventsArticle">
                        2. העלו קובץ משמרות בפורמט CSV בלבד
                    </article>

                    <article id="eventsArticle">
                        3. לחצו ״שליחת הקובץ״
                    </article>

                    <!-- <article id="eventsArticle" class="text-center">
                        <button class="btn btn-primary mb-2" onclick=" window.open('https://transportation-optimizing.web.app/currentlocation.html','_blank')">הצג מיקום נוכחי</button>                        
                    </article> -->
                </aside>
            </div>


        <footer class="text-center header_footer_bg">
            <p>
                אתר זה נבנה במסגרת סדנה במערכות מידע
                על ידי
        
                <a href="mailto:edenme@mta.ac.il">עדן מלמד</a>,
                <a href="mailto:yinoki@mta.ac.il">יוני כיאט</a> ו<a href="mailto:gurariedu@mta.ac.il">גור דובילנסקי</a>
        
                <br>
                <a href="https://www.keshetaguda.org.il/" target="_blank">אתר העמותה</a> |
                <a href="https://www.facebook.com/KeshetAguda/" target="_blank">פייסבוק</a> |
                <a href="https://mta.ac.il" target="_blank">MTA</a>
                <br>
                כל הזכויות שמורות 2022
            </p>
        </footer>


        <!-- 
                 The `defer` attribute causes the callback to execute after the full HTML
                 document has been parsed. For non-blocking uses, avoiding race conditions,
                 and consistent behavior across browsers, consider loading using Promises
                 with https://www.npmjs.com/package/@googlemaps/js-api-loader.
                -->
        <!-- <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHYcspx40UvnTRuW0YvgVMjBsHrQ9h-aM&callback=initMap&v=weekly"
            defer></script> -->

        <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
            crossorigin="anonymous"></script>

    </div>
</body>

</html>